font pango: Taskbar, Cantarell 9

input type:keyboard {
    xkb_layout fr-hyper,us
    xkb_options grp:shifts_toggle,caps:hyper
}

input type:touchpad {
    natural_scroll enabled
    tap enabled
    dwt enabled
}

output * {
    bg "#222222" solid_color
}

output eDP-1 {
    scale 1.2
    subpixel rgb
}

output DP-1 {
    scale 1.1
    subpixel rgb
    pos 0,0
}

output DP-2 {
    scale 1.1
    subpixel rgb
    pos 1745,0
}

set $laptop eDP-1
set $screen_left DP-1
set $screen_right DP-2
bindswitch --reload lid:on output $laptop disable
bindswitch --reload lid:off output $laptop enable
# bindswitch --locked --reload lid:off output $laptop enable;  output $screen_left disable; output $screen_right disable
# bindswitch --locked --reload lid:on  output $laptop disable; output $screen_left enable;  output $screen_right enable

# hide cursor if idle while 5s
seat * hide_cursor 5000

# default layout in tabbed
workspace_layout tabbed

# hide borders
hide_edge_borders --i3 none
default_border pixel 2
default_floating_border none


set $alt Mod1
set $numlock Mod2
set $hyper Mod4
set $win Mod3
floating_modifier $hyper

gaps inner 5
smart_gaps on

# Disable cursor jumping
mouse_warping none
focus_follows_mouse no

set $workspace1 workspace number 1
set $workspace2 workspace number 2
set $workspace3 workspace number 3
set $workspace4 workspace number 4
set $workspace5 workspace number 5
set $workspace6 workspace number 6
set $workspace7 workspace number 7
set $workspace8 workspace number 8
set $workspace9 workspace number 9
set $workspace0 workspace number 10

# Assign default outputs to workspaces
workspace 1  output DP-1-3  $laptop
workspace 2  output DP-1-3  $laptop
workspace 3  output DP-1-3  $laptop
workspace 4  output DP-1-3  $laptop
workspace 5  output DP-1-1  $laptop
workspace 6  output DP-1-1  $laptop
workspace 7  output DP-1-1  $laptop
workspace 8  output DP-1-1  $laptop
workspace 9  output DP-1-1  $laptop
workspace 10 output DP-1-1  $laptop

# workspace back and forth (with/without active container)
workspace_auto_back_and_forth yes

# Specific window configuration
for_window    [app_id="org.ksnip.ksnip"] floating enable
for_window    [app_id=".*"]                  sticky enable
for_window    [window_role="pop-up"]         floating enable
for_window    [app_id="firefox"]             move container to $workspace2, title_format "Firefox"
for_window    [class="Wire"]                 move container to $workspace3
for_window    [app_id="neomutt"]             move container to $workspace4, title_format "NeoMutt"
for_window    [app_id="wev"] floating enable

# Audio settings
set $mode_audio "Audio: (p)avucontrol, connect (s)hure-bt1, (a)eropex, pulse(e)ffects"
mode $mode_audio {
    bindsym --to-code {
		 p exec pavucontrol, mode "default"
	     e exec pulseeffects, mode "default"
	     s exec "connect_a2dp 00:0E:DD:06:24:1C", mode "default"
	     a exec "connect_a2dp 20:74:CF:3B:36:A9", mode "default"

        Return mode "default"
	    Escape mode "default"
    }
}


# Set shut down, restart and locking features
set $mode_system "System: (l)ock, (s)uspend, (r)eboot, (h)alt, (t)rusted, (u)ntrusted"
mode $mode_system {
	bindsym --to-code {
     l exec sway-exit lock, mode "default"
     s exec sway-exit suspend, mode "default"
     r exec sway-exit reboot, mode "default"
     h exec sway-exit shutdown, mode "default"
     t exec ttoggle -t, mode "default"
     u exec ttoggle -x, mode "default"

     Return mode "default"
     Escape mode "default"
	}
}

# set $mode_resize "Resize window"
mode $mode_resize {
    bindsym --to-code {
        h            resize grow   left  10 px or 10 ppt
        Shift+h      resize shrink right 10 px or 10 ppt
        Ctrl+h       resize grow   left  1  px or 1  ppt
        Ctrl+Shift+h resize shrink right 1  px or 1  ppt

        Shift+j      resize grow   down  10 px or 10 ppt
        j            resize shrink up    10 px or 10 ppt
        Ctrl+Shift+j resize grow   down  1  px or 1  ppt
        Ctrl+j       resize shrink up    1  px or 1  ppt

        Shift+k      resize shrink down  10 px or 10 ppt
        k            resize grow   up    10 px or 10 ppt
        Ctrl+Shift+k resize shrink down  1  px or 1  ppt
        Ctrl+k       resize grow   up    1  px or 1  ppt

        Shift+l      resize grow   right 10 px or 10 ppt
        l            resize shrink left  10 px or 10 ppt
        Ctrl+Shift+l resize grow   right 1  px or 1  ppt
        Ctrl+l       resize shrink left  1  px or 1  ppt

        # back to normal: Enter or Escape
        Return mode default
        Escape mode default
    }
}

# Move workspaces between monitors (m)
set $mode_workspaces_monitors "Move workspace between monitors: (h) left, (l) right"
mode $mode_workspaces_monitors {
	bindsym --to-code {
	  h exec swaymsg move workspace to output left, mode "default"
	  l exec swaymsg move workspace to output right, mode "default"

	  # back to normal: Enter or Escape
	  Return mode "default"
	  Escape mode "default"
	}
}


# Color scheme (Gruvbox dark)
set $color_normal_white  #a89984
set $color_bright_white  #ebdbb2
set $color_normal_gray   #222222
set $color_bright_gray   #3c3836
set $color_bright_yellow #d79921
set $color_normal_black  #282828
set $color_unused        #ff0000

# Colors                  border                 background             text                   indicator            child_border
client.focused            $color_bright_gray     $color_bright_gray     $color_bright_white    $color_bright_gray   $color_normal_black
client.focused_inactive   $color_bright_gray     $color_bright_gray     $color_bright_white    $color_bright_gray   $color_normal_black
client.unfocused          $color_normal_gray     $color_normal_gray     $color_normal_white    $color_normal_gray   $color_normal_black
client.urgent             $color_bright_yellow   $color_bright_yellow   $color_normal_black    $color_unused        $color_unused
client.placeholder        $color_unused          $color_normal_black    $color_unused          $color_unused        $color_unused

bar {
	colors {
	    # Whole color settings
	    background $color_normal_gray
	    separator  $color_bright_gray
	    statusline $color_bright_white

	    # Type             border                 background              font
	    focused_workspace  $color_bright_gray     $color_bright_gray      $color_bright_white
	    active_workspace   $color_bright_gray     $color_bright_gray      $color_bright_white
	    inactive_workspace $color_normal_gray     $color_normal_gray      $color_normal_white
	    urgent_workspace   $color_bright_yellow   $color_bright_yellow    $color_normal_black
    }

    status_command py3status --dbus-notify
	position top
    hidden_state hide
	tray_output none
	strip_workspace_numbers no
  	separator_symbol " | "
}

bindsym --to-code {
	# Media controls
	XF86AudioMute                 exec py3-cmd click 1 volume_status
	Shift+XF86AudioMute           exec pamute
	XF86AudioRaiseVolume          exec py3-cmd click 4 volume_status
	XF86AudioLowerVolume          exec py3-cmd click 5 volume_status
	XF86AudioPlay                 exec playerctl --player playerctld play-pause
	XF86AudioPrev                 exec playerctl --player playerctld previous
	XF86AudioNext                 exec playerctl --player playerctld next
	Control+$alt+Up               exec playerctl --player playerctld play-pause
	Control+$alt+Left             exec playerctl --player playerctld previous
	Control+$alt+Right            exec playerctl --player playerctld next
	Control+$alt+Down             exec playerctl --player playerctld stop

	# Screen brightness controls
	XF86MonBrightnessUp           exec set-brightness inc
	XF86MonBrightnessDown         exec set-brightness dec

	$hyper+F1                     exec "sudo -A systemctl restart kresd@1.service; resolvectl flush-caches"
	$win+F1                       exec "sudo -A systemctl restart kresd@1.service; resolvectl flush-caches"
	Print                         exec "grimshot save $(xdg-user-dir PICTURES)/Screenshots/"
	$hyper+Print                  exec "pgrep -x sway-screenshot || sway-screenshot-area"
	$win+Print                    exec "sway-gif-recorder start &"
	$win+Shift+Print              exec "sway-gif-recorder stop"

	# kakoune cheatsheet
	$hyper+F8 exec vimiv -s statusbar.show false /home/cyril/library/Pictures/kak_keybinding.png

	# media search key
	XF86Search exec xdg-open https://search.levis.ws/

	# open terminal
	$hyper+Return exec kitty
	$win+Return exec kitty

	# vault
	Shift+F2 exec "open-vault 7200 &"

	# quit app
	$win+q kill

	# launcher
	$hyper+n      fullscreen disable, exec "pgrep -x dmenu && pkill dmenu || networkmanager_dmenu"
	$hyper+m      fullscreen disable, exec "pgrep -x dmenu && pkill dmen || uudiskie-dmenu -p 'Mount'"
	$hyper+equal  fullscreen disable, exec bash -c "dmenu -p calc | xargs -r qalc -t | tee >(wl-copy) >(xargs -I{} notify-send 'calc result' '{}')"
	$hyper+w      fullscreen disable, exec "pgrep -x dmenu && pkill dmenu || browser"
	$hyper+p      fullscreen disable, exec "pgrep -x dmenu && pkill dmenu || { sway-paste lock; passmenu -p 'pass'; sway-paste unlock; }"
	$hyper+f	  fullscreen disable, exec "pgrep -x dmenu && pkill dmenu || sway-paste dmenu"
	twosuperior   fullscreen disable, exec "pgrep -x dmenu && pkill dmenu || rofi-todoist"
	$hyper+d      fullscreen disable, exec "pgrep -x wofi && pkill  wofi || wofi"

	# Switch to workspace using number row
	$hyper+ampersand  $workspace1
	$hyper+eacute     $workspace2
	$hyper+quotedbl   $workspace3
	$hyper+apostrophe $workspace4
	$hyper+parenleft  $workspace5
	$hyper+minus      $workspace6
	$hyper+egrave     $workspace7
	$hyper+underscore $workspace8
	$hyper+ccedilla   $workspace9
	$hyper+agrave     $workspace0

	# Move window to workspace using number row
	$win+ampersand  move container to $workspace1
	$win+eacute     move container to $workspace2
	$win+quotedbl   move container to $workspace3
	$win+apostrophe move container to $workspace4
	$win+parenleft  move container to $workspace5
	$win+minus      move container to $workspace6
	$win+egrave     move container to $workspace7
	$win+underscore move container to $workspace8
	$win+ccedilla   move container to $workspace9
	$win+agrave     move container to $workspace0


	# Change focus
	$hyper+h focus left
	$hyper+j focus down
	$hyper+k focus up
	$hyper+l focus right

	# Move focused window
	$win+h move left
	$win+j move down
	$win+k move up
	$win+l move right

	# toggle menu bar
	$win+Shift+m bar mode toggle

	# Split
	$hyper+s split toggle

	# move workspace to the right monitor
	$win+BackSpace move workspace to output right
	$hyper+BackSpace move container to output right

	# toggle fullscreen mode for the focused container
	$win+f fullscreen toggle, inhibit_idle fullscreen

	# container layout: tabbed
	$hyper+t layout tabbed

	# container layout: split
	$hyper+e layout toggle split

	# toggle tiling / floating
	$win+space floating toggle

	# change focus between tiling / floating windows
	$hyper+space focus mode_toggle

	# focus the parent container (hyper+a)
	$hyper+a focus parent

	# Focus the child container (hyper+z)
	$hyper+z focus child

	# move the currently focused window to the scratchpad
	$win+twosuperior move scratchpad

	# Show the next scratchpad window or hide the focused scratchpad window.
	# If there are multiple scratchpad windows, this command cycles through them.
	$hyper+twosuperior scratchpad show

	# switch to workspace with urgent window automatically
	$win+x [urgent=latest] focus

	# reload the configuration file
	$win+r reload

	# mode
	$win+p mode $mode_audio
	$win+Escape mode $mode_system
	$win+m mode $mode_workspaces_monitors
	$hyper+r mode "resize"

	# notification
	Ctrl+Space exec makoctl dismiss
	Ctrl+Shift+Space exec makoctl dismiss --all
	$hyper+o exec makoctl menu dmenu
}

exec_always "pgrep -x mako || mako"
exec_always "pgrep -x nm-applet || nm-applet"
exec_always "pgrep -x opensnitch-ui || opensnitch-ui"
exec_always "pgrep -x redshift || redshift"
exec_always "pgrep -x solaar || solaar --restart-on-wake-up"
exec_always "pgrep -x udiskie || udiskie"
exec_always "pgrep -x sway-autoname-w; sway-autoname-workspaces -d"
exec_always "pgrep -fx 'sh /usr/bin/wire-desktop' || wire-desktop"
exec_always "pgrep -x sway-fade-inact || sway-fade-inactive -o 0.7"
exec_always "pgrep -x sway-paste || sway-paste daemon"
exec "kitty --class neomutt --title neomutt neomutt"
exec_always swayidle -w timeout 120 'swaymsg "output * dpms off"' timeout 180 'sway-exit lock' resume 'swaymsg "output * dpms on"' before-sleep 'sway-exit lock'
