set $laptop eDP-1
bindswitch lid:on output $laptop disable
bindswitch lid:off output $laptop enable

output DP-5 pos 0 0 res 1920x1080
output DP-3 pos 1920 0 res 1920x1080

input type:keyboard {
    xkb_layout fr-hyper,us
    xkb_options grp:shifts_toggle,caps:hyper
    events disabled_on_external_mouse
}

input type:touchpad {
    natural_scroll enabled
    left_handed enabled
    accel_profile adaptive
    tap enabled
    dwt enabled
}

output eDP-1 {
    scale 1.2
    bg "#202020" solid_color
}

seat * hide_cursor 5000

# Set mod key (Mod1=<Alt>, Mod4=<Super>, Mod3=<Hyper(CapsLocks)>)
set $alt Mod1
set $numlock Mod2
set $hyper Mod4
set $win Mod3

# Use Mouse+$hyper to drag floating windows
floating_modifier $hyper

# set default desktop layout (default is tiling)
# workspace_layout tabbed <stacking|tabbed>
workspace_layout tabbed

# Hide borders
hide_edge_borders both
default_border none

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
font pango: Taskbar, Cantarell 9


# Audio settings
bindcode $win+33 mode "$mode_audio"
set $mode_audio Audio: (p)avucontrol, connect (s)hure-bt1, (a)eropex, pulse(e)ffects
mode "$mode_audio" {
    # (p)
    bindcode 33 exec pavucontrol, mode "default"
    # (e)
    bindcode 26 exec pulseeffects, mode "default"
    # (s)
    bindcode 39 exec "connect_a2dp 00:0E:DD:06:24:1C", mode "default"
    # (a)
    bindcode 24 exec "connect_a2dp 20:74:CF:3B:36:A9", mode "default"

    # exit system mode: "Enter" or "Escape"
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym XF86AudioMute         exec py3-cmd click 1 volume_status
bindsym Shift+XF86AudioMute   exec pamute
bindsym XF86AudioRaiseVolume  exec py3-cmd click 4 volume_status
bindsym XF86AudioLowerVolume  exec py3-cmd click 5 volume_status
bindsym XF86AudioPlay exec playerctl -p $(tail -1 /tmp/player-last) play-pause
bindsym XF86AudioPrev exec playerctl -p $(tail -1 /tmp/player-last) previous
bindsym XF86AudioNext exec playerctl -p $(tail -1 /tmp/player-last) next


# Screen brightness controls
bindsym XF86MonBrightnessUp   exec set-brightness inc
bindsym XF86MonBrightnessDown exec set-brightness dec
bindsym Shift+XF86MonBrightnessUp   exec set-brightness inc
bindsym Shift+XF86MonBrightnessDown exec set-brightness dec


bindsym --to-code {
# Start Applications
# mod+n
 $hyper+n exec networkmanager_dmenu
# mod+m
 $hyper+m exec UDISKIE_DMENU_LAUNCHER="rofi" udiskie-dmenu -p "Mount" -matching regex -dmenu -i -no-custom -multi-select
# mod+F1
 $hyper+F1 exec "autorandr --change --force; sudo -A systemctl restart kresd@1.service; resolvectl flush-caches; xmodmap ~/.Xmodmap 2>/dev/null"
 $win+F1 exec "autorandr --change --force; sudo -A systemctl restart kresd@1.service; resolvectl flush-caches; xmodmap ~/.Xmodmap 2>/dev/null"
# display
 XF86Display --release exec autorandr --change
# mod+Shift+d
 $win+d --release exec "killall dunst; exec notify-send 'restart dunst'"
# mod+scroll_lock
 $hyper+Scroll_Lock exec "killall screenkey || screenkey"
# printscreen
 Print exec "flameshot full -p ~/library/Pictures/Screenshots -c"
# mod+printscreen
 $hyper+Print exec "flameshot gui"

# calendar (c)
 $hyper+c exec gsimplecal

# mod+F7
 $hyper+F7 exec feh /home/cyril/library/Pictures/ru.png
# mod+F8
 $hyper+F8 exec feh /home/cyril/library/Pictures/kak_keybinding.png

# search
 XF86Search exec brave https://search.levis.ws/

# start a terminal
 $hyper+Return exec kitty
 $win+Return exec kitty

# kill focused window (q)
 $win+q kill

# Open vault (shift+F2)
 Shift+F2 exec "open-vault 7200 &"
# Nautilus (shift+F3)
 Shift+F3 exec "nemo &"

# Start a launcher (=)(d)(o)(w)(p)
 $hyper+equal exec "calc"
 $hyper+Tab exec "rofi -normal-window -show file-browser"
 $hyper+u exec "rofimoji --rofi-args='-normal-window -matching normal -columns 3'"
 $hyper+w exec "surfraw-rofi"
 $win+w exec "surfraw duckduckgo -j $(wl-paste)"
 $hyper+p exec "rofi-pass"
 twosuperior exec "rofi-todoist"
 $hyper+d exec "pgrep rofi && killall rofi || rofi -combi-modi window,drun,ssh -show combi -modi combi -columns 2"
}

# Workspaces
focus_follows_mouse no

set $workspace1 workspace number 1
set $workspace2 workspace number 2
set $workspace3 workspace number 3
set $workspace4 workspace number 4
set $workspace5 workspace number 5
set $workspace6 workspace number 6
set $workspace7 workspace number 7
set $workspace8 workspace number 8
set $workspace9 workspace number 9
set $workspace0 workspace number 10

# Switch to workspace using number row
bindsym --to-code {
 $hyper+1 $workspace1
 $hyper+2 $workspace2
 $hyper+3 $workspace3
 $hyper+4 $workspace4
 $hyper+5 $workspace5
 $hyper+6 $workspace6
 $hyper+7 $workspace7
 $hyper+8 $workspace8
 $hyper+9 $workspace9
 $hyper+0 $workspace0

# Move window to workspace using number row
 $win+1 move container to $workspace1
 $win+2 move container to $workspace2
 $win+3 move container to $workspace3
 $win+4 move container to $workspace4
 $win+5 move container to $workspace5
 $win+6 move container to $workspace6
 $win+7 move container to $workspace7
 $win+8 move container to $workspace8
 $win+9 move container to $workspace9
 $win+0 move container to $workspace0
}
# Assign default outputs to workspaces
workspace 1  output DP-1-3  eDP-1
workspace 2  output DP-1-3  eDP-1
workspace 3  output DP-1-3  eDP-1
workspace 4  output DP-1-3  eDP-1
workspace 5  output DP-1-1  eDP-1
workspace 6  output DP-1-1  eDP-1
workspace 7  output DP-1-1  eDP-1
workspace 8  output DP-1-1  eDP-1
workspace 9  output DP-1-1  eDP-1
workspace 10 output DP-1-1  eDP-1

# workspace back and forth (with/without active container)
workspace_auto_back_and_forth yes

bindsym --to-code {
# alternatively, you can use the cursor keys:
 $hyper+Left focus left
 $hyper+Down focus down
 $hyper+Up focus up
 $hyper+Right focus right

# alternatively, you can use the cursor keys:
 $win+Left move left
 $win+Down move down
 $win+Up move up
 $win+Right move right

# split orientation
 $hyper+h split h
 $hyper+v split v
 $hyper+q split toggle

# move workspace to the right monitor
 $win+BackSpace move workspace to output right
 $hyper+BackSpace move container to output right

# toggle fullscreen mode for the focused container
 $win+f fullscreen toggle
 $hyper+s layout stacked
 $hyper+t layout tabbed
 $hyper+e layout toggle tabbed splith splitv stacked

# toggle tiling / floating
 $win+space floating toggle

# change focus between tiling / floating windows
 $hyper+space focus mode_toggle

# toggle sticky (Shift+s)
 $win+s sticky toggle

# focus the parent container (hyper+a)
 $hyper+a focus parent

# Focus the child container (hyper+z)
 $hyper+z focus child

# move the currently focused window to the scratchpad
 $win+twosuperior move scratchpad

# Show the next scratchpad window or hide the focused scratchpad window.
# If there are multiple scratchpad windows, this command cycles through them.
 $hyper+twosuperior scratchpad show

#navigate workspaces next / previous
 $hyper+Ctrl+Right workspace next
 $hyper+Ctrl+Left workspace prev

# switch to workspace with urgent window automatically
 $win+x [urgent=latest] focus

# reload the configuration file
 $win+r reload
}

# autoname workspaces
exec  sway-autoname-workspaces &

# Specific window configuration
# Bindings to make the webcam float and stick.
# # float edit_text windows
for_window [title="^edit_text$"] floating enable
for_window    [window_role="pop-up"] floating enable
for_window    [class="Peek"] floating enable
for_window    [class="Rofi"] floating enable
for_window    [class="copyq"] floating enable
for_window    [class="Tor Browser"] move container to $workspace3, floating enable border normal
for_window    [class="neomutt"] move container to $workspace2
for_window    [class="(?i)chromium"] move window to workspace current, title_format "Chromium"
for_window    [class="Wire"] move container to $workspace1
for_window    [class="zoom"] floating enable, sticky disable
for_window    [class="xfreerdp"] move container to $workspace9
for_window    [class="seafile-applet"] floating enable
for_window    [class="com-sun-javaws-Main"] floating enable
for_window    [class="feh|Keepassx|Pavucontrol|Steam|Pulseaudio-equalizer-gtk|mpv|vaapi"] floating enable
for_window    [class="com-stonesoft-client-launcher-SmcClient|sun-awt-X11-XDialogPeer"] floating enable
for_window    [title="Event Tester"] floating enable
for_window    [class="(?i)zathura"] focus, layout tabbed, border normal
for_window    [class="seafile-applet"] floating enable
for_window    [title="^Qalculate!$"] floating enable
for_window    [title="Preferences$"] floating enable


# Set shut down, restart and locking features
bindsym $hyper+Escape mode "$mode_system"
set $mode_system (l)ock,  (s)uspend, (h)ibernate, (r)eboot, (Shift+s)hutdown, (t)rusted, (u)ntrusted, (x)kill
mode "$mode_system" {
    # (l)
    bindcode 46 exec i3exit lock, mode "default"
    # (s)
    bindcode 39 exec i3exit suspend, mode "default"
    # (e)
    bindcode 27 exec i3exit reboot, mode "default"
    # (s)
    bindcode Shift+39 exec i3exit shutdown, mode "default"
    # (t)
    bindcode 28 exec ttoggle -t, mode "default"
    # (u)
    bindcode 30 exec ttoggle -x, mode "default"
    # (x)
    bindcode 53 --release exec xkill, mode "default"

    # exit system mode: "Enter" or "Escape"
    bindsym Return mode "default"
    bindsym Escape mode "default"
}

# Resize window (you can also use the mouse for that)
# (r)
bindsym --to-code $hyper+r mode "resize"
mode "resize" {
        # (j)
        bindcode 44 resize shrink width 5 px or 5 ppt
        # (k)
        bindcode 45 resize grow height 5 px or 5 ppt
        # (l)
        bindcode 46 resize shrink height 5 px or 5 ppt
        # (semicolon)
        bindcode 59 resize grow width 5 px or 5 ppt

        # same bindings, but for the arrow keys
        bindsym Left resize shrink width 10 px or 10 ppt
        bindsym Down resize grow height 10 px or 10 ppt
        bindsym Up resize shrink height 10 px or 10 ppt
        bindsym Right resize grow width 10 px or 10 ppt

        # exit resize mode: Enter or Escape
        bindsym Return mode "default"
        bindsym Escape mode "default"
}

bindsym --to-code {
# Lock screen
  $win+l exec swayexit lock
  $hyper+l exec swayexit lock
  Control+$alt+l exec swayexit lock
  $hyper+f fullscreen disable, exec copyq toggle

# Make floater
 $win+Control+m floating enable; resize set 320 px 180 px; sticky enable; move window to position 1600 px 24 px
}

# Color scheme (Gruvbox dark)
set $color_normal_white  #a89984
set $color_bright_white  #ebdbb2
set $color_normal_gray   #222222
set $color_bright_gray   #3c3836
set $color_bright_yellow #d79921
set $color_normal_black  #282828
set $color_unused        #ff0000

# Colors                  border                 background             text                   indicator       child_border
client.focused            $color_bright_gray     $color_bright_gray     $color_bright_white    $color_unused   $color_normal_white
client.focused_inactive   $color_bright_gray     $color_bright_gray     $color_bright_white    $color_unused   $color_normal_black
client.unfocused          $color_normal_gray     $color_normal_gray     $color_normal_white    $color_unused   $color_normal_black
client.urgent             $color_bright_yellow   $color_bright_yellow   $color_normal_black    $color_unused   $color_unused
client.placeholder        $color_unused          $color_normal_black    $color_unused          $color_unused   $color_unused

# Start i3bar to display a workspace bar (plus the system information i3status if available)
bar {
	colors {
    # Whole color settings
    background $color_normal_gray
    separator  $color_bright_gray
    statusline $color_bright_white

    # Type             border                 background              font
    focused_workspace  $color_bright_gray     $color_bright_gray      $color_bright_white
    active_workspace   $color_bright_gray     $color_bright_gray      $color_bright_white
    inactive_workspace $color_normal_gray     $color_normal_gray      $color_normal_white
    urgent_workspace   $color_bright_yellow   $color_bright_yellow    $color_normal_black
    }

    status_command py3status --dbus-notify
	position top
    hidden_state hide
	tray_output none
	strip_workspace_numbers no
  	separator_symbol " | "
    output eDP-1
    output DP-1-1
    output LVDS-1
}

# bar {
# 	colors {
#     # Whole color settings
#     background $color_normal_gray
#     separator  $color_bright_gray
#     statusline $color_bright_white

#     # Type             border                 background              font
#     focused_workspace  $color_bright_gray     $color_bright_gray      $color_bright_white
#     active_workspace   $color_bright_gray     $color_bright_gray      $color_bright_white
#     inactive_workspace $color_normal_gray     $color_normal_gray      $color_normal_white
#     urgent_workspace   $color_bright_yellow   $color_bright_yellow    $color_normal_black
#     }

# 	position top
#     hidden_state hide
# 	tray_output none
# 	strip_workspace_numbers no
#     output DP-1-2
#     output DP-1-3
# }

# hide/unhide i3status bar
# (win+Shift+m)
bindcode $win+Shift+47 bar mode toggle

#############################
### settings for i3-gaps: ###
#############################
# Set inner/outer gaps
gaps inner 5
smart_gaps on

# Smart borders (draw borders around container only if it is not the only container on this workspace)
# on|no_gaps (on=always activate and no_gaps=only activate if the gap size to the edge of the screen is 0)
#smart_borders on

# Press $win+g to enter the gap mode. Choose o or i for modifying outer/inner gaps. Press one of + / - (in-/decrement for current workspace) or 0 (remove gaps for current workspace). If you also press Shift with these keys, the change will be global for all workspaces.
set $mode_gaps Gaps: (o) outer, (i) inner
set $mode_gaps_outer Outer Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_inner Inner Gaps: +|-|0 (local), Shift + +|-|0 (global)
# (mod+Shift+g)
bindcode $win+42 mode "$mode_gaps"

mode "$mode_gaps" {
        # (o)
        bindcode 32 mode "$mode_gaps_outer"
        # (i)
        bindcode 31 mode "$mode_gaps_inner"

        bindsym Return mode "default"
        bindsym Escape mode "default"
}
mode "$mode_gaps_inner" {
        # (plus)
        bindcode 21 gaps inner current plus 5
        # (minus)
        bindcode 15 gaps inner current minus 5
        # (0)
        bindcode 19 gaps inner current set 0

        # (plus)
        bindcode Shift+21 gaps inner all plus 5
        # (minus)
        bindcode Shift+15 gaps inner all minus 5
        # (0)
        bindcode Shift+19 gaps inner all set 0

        bindsym Return mode "default"
        bindsym Escape mode "default"
}
mode "$mode_gaps_outer" {
        bindcode 21 gaps outer current plus 5
        bindcode 15 gaps outer current minus 5
        bindcode 19 gaps outer current set 0

        bindcode Shift+21 gaps outer all plus 5
        bindcode Shift+15 gaps outer all minus 5
        bindcode Shift+19 gaps outer all set 0

        bindsym Return mode "default"
        bindsym Escape mode "default"
}


# Move workspaces between monitors (m)
set $mode_workspaces_monitors Move workspace between monitors
mode "$mode_workspaces_monitors" {
  # (h)
  bindcode 43 exec i3-msg move workspace to output left, mode "default"
  # (l)
  bindcode 46 exec i3-msg move workspace to output right, mode "default"

  # back to normal: Enter or Escape
  bindsym Return mode "default"
  bindsym Escape mode "default"
}
bindcode $win+47 mode $mode_workspaces_monitors


# Cycle through workspaces with mouse.
bindsym --whole-window $hyper+button6 workspace next
bindsym --whole-window $hyper+button7 workspace prev

exec --no-startup-id  /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 &
exec "kitty --class neomutt --title neomutt neomutt &"
exec "wire-desktop &"
exec kitty &
exec_always --no-startup-id "pgrep -x solaar || (solaar --restart-on-wake-up &)"
exec_always --no-startup-id "pgrep -x nm-applet || (nm-applet &)"
exec_always --no-startup-id "pgrep -x udiskie || (udiskie &)"
exec_always --no-startup-id "pgrep -x unclutter || (unclutter -b)"
exec_always "pgrep -x copyq || (QPA_PLATFORM=xcb copyq &)"
exec_always "pgrep -x aa-notify || (aa-notify -p -s 1 -w 60 -f /var/log/audit/audit.log &)"
exec_always "pgrep -x opensnitch-ui || (opensnitch-ui & )"
exec_always "pgrep -x kanshi || (kanshi &)"
exec_always "pgrep -x mako || (mako &)"
bindsym Ctrl+Space exec  makoctl dismiss
bindsym Ctrl+Shift+Space exec  makoctl dismiss --all
exec --no-startup-id swayidle -w timeout 180 'swayexit lock' timeout 300 'swaymsg "output * dpms off"' resume 'swaymsg "output * dpms on"' before-sleep 'swayexit suspend'
