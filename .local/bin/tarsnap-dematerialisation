#!/bin/bash

open-vault 3600

[ ! -f ~/.cache/tarsnap.key ] && pass backup/tarsnap-key > ~/.cache/tarsnap.key && chmod 400 ~/.cache/tarsnap.key

[ -f ~/Vault/.lock ] && tarsnap --keyfile ~/.cache/tarsnap.key --cachedir /tmp/tarsnap-cache --fsck
[ -f ~/Vault/.lock ] && tarsnap --keyfile ~/.cache/tarsnap.key -c --cachedir /tmp/tarsnap-cache -f "$(hostname)-dematerialisation-$(date +%Y-%m-%d_%H-%M-%S)" -v --print-stats ~/Vault/Dematerialisation ~/.dotfiles ~/library/contacts ~/library/calendars
