#!/bin/bash

state="$(timeout 5 piactl get connectionstate)"

vpn() {
    if [[ "x${state}x" == "xConnectedx" ]]; then
        icon=''
        class=on
    else
        icon=''
        class=off
    fi
    tooltip="$(timeout 5 piactl get region 2> /dev/null)"
    printf '{"text": " %s ", "tooltip": "%s", "class": "%s"}\n' "$icon" "$tooltip" "$class"
}

vpn

ip monitor link | while read -r line; do vpn; done
