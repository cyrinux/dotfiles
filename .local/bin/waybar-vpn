#!/bin/bash

vpn() {
    state=$1
    if [[ "x${state}x" == "xConnectedx" ]]; then
        icon=''
        class=on
    else
        icon=''
        class=off
    fi
    tooltip="$(timeout 5 piactl get region 2> /dev/null)"
    printf '{"text": " %s ", "tooltip": "%s", "class": "%s"}\n' "$icon" "$tooltip" "$class"
}

vpn

piactl monitor connectionstate | while read -r state; do vpn $state; done
