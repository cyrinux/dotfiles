#!/bin/bash

trap 'pkill -P $$ && pkill -RTMIN+3 -x waybar' EXIT

{ sleep 5 && pkill -RTMIN+3 -x waybar; } &

case $1 in
    toggle-stream)
        pgrep -x obs || cglaunch obs &
        sleep 1
        obs-cli stream toggle
        ;;
    toggle-recording)
        pgrep -x obs || cglaunch obs &
        sleep 1
        obs-cli recording toggle
        ;;
    preview)
        nohup mpv rtmp://live.levis.name:1935/stream/cyrinux
        ;;
    stop)
        obs-cli stream stop
        obs-cli recording stop
        killall obs
        ;;
    *)
        echo "Help: $0 toggle-stream|toggle-recording|preview|stop"
        ;;
esac
