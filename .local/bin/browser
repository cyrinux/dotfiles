#!/bin/bash
# pass edit work/works-url-patterns
# then edit rules
# with format:
# *.example.com@work
# *.work.org/.*@work
#
# first match win
set -euo pipefail -x

url="${1:-google.com}"

list="$XDG_CACHE_HOME/works-url-patterns"
[ -s "$list" ] || pass work/works-url-patterns > $list

# echo $url
if [ -s "${list}" ]; then
	while read line; do
		rule=${line%%@*}
		if [[ ${url} =~ ${rule} ]]; then
			container=${line##*@}
			break
		fi
	done < $list
fi

if [ -z "${container:-}" ]; then
	container=$(printf "personal\nwork\nshopping\nprivate\nclipboard\nmpv" | dmenu -p "browser")
fi

case $container in
	"personal")
		cglaunch firefox-container --fingerprint --orange --name=Personal "$url" &
		;;
	"work")
		cglaunch firefox-container --briefcase --blue --name=Work "$url" &
		;;
	"shopping")
		cglaunch firefox "ext+container:name=Shopping&url=$url" &
		;;
	"private")
		cglaunch firefox --private-window "$url" &
		;;
	"clipboard")
		echo "$url" | wl-copy &
		;;
	"mpv")
		cglaunch mpv "$url" &
		;;
esac
