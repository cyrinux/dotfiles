#!/bin/bash
trap 'pkill -P $$' EXIT

vpn() {
    if [ -e "/sys/class/net/tun0" ]; then
        icon=''
        class=on
    else
        icon=''
        class=off
    fi
    tooltip="$(timeout 5 mullvad status -l | perl -pe 's/\n/\\n/g' | perl -pe 's/(?:\\n)+$//')"
    printf '{"text": " %s ", "tooltip": "%s", "class": "%s"}\n' "$icon" "$tooltip" "$class"
}

vpn

ip monitor link | while read -r line; do vpn; done
